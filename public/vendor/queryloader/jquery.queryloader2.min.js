/*
 * QueryLoader v2 - A simple script to create a preloader for images
 *
 * For instructions read the original post:
 * http://www.gayadesign.com/diy/queryloader2-preload-your-images-with-ease/
 *
 * Copyright (c) 2011 - Gaya Kessler
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Version:  2.6
 * Last update: 2013-10-23
 */
function OverlayLoader(a){this.parent=a,this.container,this.loadbar,this.percentageContainer}function PreloadContainer(a){this.toPreload=[],this.parent=a,this.container}function PreloadImage(a){this.element,this.parent=a}function QueryLoader2(a,b){this.element=a,this.$element=$(a),this.options=b,this.foundUrls=[],this.destroyed=!1,this.imageCounter=0,this.imageDone=0,this.alreadyLoaded=!1,this.preloadContainer=new PreloadContainer(this),this.overlayLoader=new OverlayLoader(this),this.defaultOptions={onComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:!1,deepSearch:!0,completeAnimation:"fade",minimumTime:500},this.init()}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}OverlayLoader.prototype.createOverlay=function(){var a="absolute";"body"==this.parent.element.tagName.toLowerCase()?a="fixed":this.parent.$element.css("position","relative"),this.container=$("<div id='"+this.parent.options.overlayId+"'></div>").css({width:"100%",height:"100%",backgroundColor:this.parent.options.backgroundColor,backgroundPosition:"fixed",position:a,zIndex:666999,top:0,left:0}).appendTo(this.parent.$element),this.loadbar=$("<div id='qLbar'></div>").css({height:this.parent.options.barHeight+"px",marginTop:"-"+this.parent.options.barHeight/2+"px",backgroundColor:this.parent.options.barColor,width:"0%",position:"absolute",top:"50%"}).appendTo(this.container),1==this.parent.options.percentage&&(this.percentageContainer=$("<div id='qLpercentage'></div>").text("0%").css({height:"40px",width:"100px",position:"absolute",fontSize:"3em",top:"50%",left:"50%",marginTop:"-"+(59+this.parent.options.barHeight)+"px",textAlign:"center",marginLeft:"-50px",color:this.parent.options.barColor}).appendTo(this.container)),this.parent.preloadContainer.toPreload.length&&1!=this.parent.alreadyLoaded||this.parent.destroyContainers()},OverlayLoader.prototype.updatePercentage=function(a){this.loadbar.stop().animate({width:a+"%",minWidth:a+"%"},200),1==this.parent.options.percentage&&this.percentageContainer.text(Math.ceil(a)+"%")},PreloadContainer.prototype.create=function(){this.container=$("<div></div>").appendTo("body").css({display:"none",width:0,height:0,overflow:"hidden"}),this.processQueue()},PreloadContainer.prototype.processQueue=function(){for(var a=0;this.toPreload.length>a;a++)this.parent.destroyed||this.preloadImage(this.toPreload[a])},PreloadContainer.prototype.addImage=function(a){this.toPreload.push(a)},PreloadContainer.prototype.preloadImage=function(a){var b=new PreloadImage;b.addToPreloader(this,a),b.bindLoadEvent()},PreloadImage.prototype.addToPreloader=function(a,b){this.element=$("<img />").attr("src",b),this.element.appendTo(a.container),this.parent=a.parent},PreloadImage.prototype.bindLoadEvent=function(){this.parent.imageCounter++,this.element.on("load error",this,function(a){a.data.completeLoading()})},PreloadImage.prototype.completeLoading=function(){this.parent.imageDone++;var a=100*(this.parent.imageDone/this.parent.imageCounter);this.parent.overlayLoader.updatePercentage(a),this.parent.imageDone==this.parent.imageCounter&&this.parent.endLoader()},QueryLoader2.prototype.init=function(){if(this.checkIfVisited(),this.options=$.extend({},this.defaultOptions,this.options),this.findImageInElement(this.element),1==this.options.deepSearch)for(var a=this.$element.find("*:not(script)"),b=0;b<a.length;b++)this.findImageInElement(a[b]);this.preloadContainer.create(),this.overlayLoader.createOverlay()},QueryLoader2.prototype.findImageInElement=function(a){var b="",c=$(a),d="normal";if("none"!=c.css("background-image")?(b=c.css("background-image"),d="background"):"undefined"!=typeof c.attr("src")&&"img"==a.nodeName.toLowerCase()&&(b=c.attr("src")),!this.hasGradient(b)){b=this.stripUrl(b);for(var e=b.split(", "),f=0;f<e.length;f++)if(this.validUrl(e[f])&&this.urlIsNew(e[f])){var g="";if(this.isIE()||this.isOpera())g="?rand="+Math.random(),this.preloadContainer.addImage(e[f]+g);else if("background"==d)this.preloadContainer.addImage(e[f]+g);else{var h=new PreloadImage(this);h.element=c,h.bindLoadEvent()}this.foundUrls.push(e[f])}}},QueryLoader2.prototype.hasGradient=function(a){return-1==a.indexOf("gradient")?!1:!0},QueryLoader2.prototype.stripUrl=function(a){return a=a.replace(/url\(\"/g,""),a=a.replace(/url\(/g,""),a=a.replace(/\"\)/g,""),a=a.replace(/\)/g,"")},QueryLoader2.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)},QueryLoader2.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)},QueryLoader2.prototype.validUrl=function(a){return a.length>0&&!a.match(/^(data:)/i)?!0:!1},QueryLoader2.prototype.urlIsNew=function(a){return-1==this.foundUrls.indexOf(a)?!0:!1},QueryLoader2.prototype.destroyContainers=function(){this.destroyed=!0,this.preloadContainer.container.remove(),this.overlayLoader.container.remove()},QueryLoader2.prototype.endLoader=function(){this.setVisited(),this.destroyed=!0,this.onLoadComplete()},QueryLoader2.prototype.onLoadComplete=function(){if("grow"==this.options.completeAnimation){var a=500;this.overlayLoader.loadbar[0].parent=this,this.overlayLoader.loadbar.stop().animate({width:"100%"},a,function(){$(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent,this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})})})}else this.overlayLoader.container[0].parent=this,this.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})},QueryLoader2.prototype.setVisited=function(){supports_html5_storage()&&localStorage.setItem(window.location.href,"true")},QueryLoader2.prototype.checkIfVisited=function(){if(supports_html5_storage()){var a=localStorage.getItem(window.location.href);"true"==a&&(this.alreadyLoaded=!0)}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(a){a.fn.queryLoader2=function(a){return this.each(function(){new QueryLoader2(this,a)})}}(jQuery);